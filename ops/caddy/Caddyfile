:80 {
    handle_path /api/* {
        reverse_proxy backend:8000
    }

    handle {
        reverse_proxy frontend:5173
    }

    handle_errors {
        @frontend_down expression {http.error.status_code} == 502 || {http.error.status_code} == 503 || {http.error.status_code} == 504
        handle @frontend_down {
            root * /srv/static
            try_files {http.request.uri.path} /index.html
            file_server
        }
    }

    handle {
        root * /srv/static
        try_files {path} /index.html
        file_server
    }
}
